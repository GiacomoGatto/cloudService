{% extends "applayout.html" %}

{% block body %}


<div class="row" style="">
    <div class="col-md-12">
        <div class="container" style="margin-top:3%;"> 
                <b>
                    <p>
                    What are you going to do in space?</p>
                </b>
        </div>
    </div>
</div>

<div class="row" style="display:none;" id="show-row">
    <div class="col-md-12">
        <div class="container" style="margin-top:3%;"> 
            <div id="show-message" style="width:45%; margin:auto auto; padding: 15px;border-radius:15px; border: 1px solid red;">
            </div>
        </div>
    </div>
</div>

<div class="row" style="">
        <div class="col-md-1"></div>
        <div class="col-md-10">
           <div class="hr5" style="margin-top:40px; margin-bottom:40px;"></div>    
                {% for m in missions %}
                {% if forloop.first %}
                    <div class="row">
                {% endif %}
                {% ifequal forloop.counter|divisibleby:3 1 %}
                    <div class="row">
                {% endifequal %}
                 <!-- Start Icon Box 1-->
                        <div class="col-md-3 service-box service-center">
                            <div class="service-boxed">
                                <div class="service-icon" style="margin-top:-30px;">
                                 
                                        <i class="glyphicon icon-medium-effect"></i>
                             
                                </div>
                                <div class="service-content">
                                    <h4>{{m.name}}</h4>
                                    <div style="width:200px;height:200px;margin: auto auto;"><img src="{{t.image_url}}" style="margin: auto auto;"/></div>
                                    <p style="margin-bottom:20px;">{{m.description}}</p>
                                    <p><a mission="{{m.slug}}" class="submit btn btn-default" href="#">Choose</a></p>
                                </div>
                            </div>
                        </div>
                        <!-- End Icon Box 1-->
                        {% ifequal forloop.counter|divisibleby:3 1 %}
                             </div>
                        {% endifequal %}
                        {% if forloop.last %}
                             </div> 
                        {% endif %}
                        {% endfor %}
                                          
        </div>
</div>

{% block script %}
<script>

$('.submit').on('click', function(){
    mission = $(this).attr('mission');

    url = '/simulation/?destination={{destination}}&mission='+mission

    console.log(url)

    $.ajax({
    url: url,
    type: 'GET',
    async: false,
    success: function (data) {
        console.log(data)
        if (data.code == 0) window.location.href = '/webapp/go/to/{{destination}}/to/'+mission
        else { 
            $('#show-row').fadeIn('slow')
            $('#show-message').html('<p style="font-weight:bold;color:red;">'+data.content+'</p>')
            $('#show-message').addClass('bg-danger')
            setInterval(function () {
                $('#show-message').html('')
                $('#show-row').fadeOut();

            }, 5999);

        }

        
    },
    error: function (xhr, ajaxOptions, thrownError) {
        console.log('Errore:' + xhr.status);
        console.log(thrownError);
    }
    });

});

</script>
{% endblock %}

{% endblock %}